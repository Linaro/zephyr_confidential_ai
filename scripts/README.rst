COSE signature verification and get the inference value
#######################################################

Overview
********

This python script is used to verify the COSE SIGN1 signature in secure inference samples.

It is based upon: https://github.com/TimothyClaeys/pycose

Note:
This script will be extended in future to support COSE DECRYPT functionality.

Prerequisites
*************

1. Install python 3.7.x using ``sudo apt install python3 python3-pip`` command
2. Install pycose using the ``pip install cose`` command


Running the script
******************

   .. code-block:: console

      cose_verify.py [-h] [-a ACTION] [-p PAYLOAD] [-k PUBLICKEY] [-t PAYLOAD_TYPE]

Supported command line arguments
================================

``--action`` or ``-a``

1. COSE_SIGN1_VERIFY (default)
2. COSE_DECRYPT_VERIFY

``--payload`` or ``-p``

Cose inference value encoded and signed payload in bytes format as an argument

``--publickey`` or ``-k``

The public key is in the form of 'FORMAT + X + Y' of 65bytes as an argument

``--type`` or ``-t``

1. INFERENCE (default)
2. AAT

Example to decode inference value
=================================
   .. code-block:: console

      ./cose_verify.py -p 0xd2,0x84,0x43,0xa1,0x1,0x26,0xa0,0x4b,0xa1,0x3a,0x0,0x1,0x38,0x7f,0x44,0x1f,0x85,0xab,0x3f,0x58,0x40,0xb7,0x61,0x7c,0x38,0x29,0x4b,0xe,0x78,0xbf,0x92,0xb5,0x93,0x74,0x9c,0x6c,0x40,0x72,0x13,0x71,0xb0,0x6a,0x8a,0x2,0x49,0x4f,0xa4,0xad,0x7b,0x15,0x8,0x10,0x4a,0x37,0xc6,0x26,0x17,0x31,0xee,0xcf,0x60,0x89,0xa7,0xfc,0x46,0x71,0xfd,0x6e,0xe1,0x63,0xe5,0x13,0x33,0xcb,0x57,0x2f,0x7e,0x75,0x75,0x1a,0x25,0xc1,0xd2,0x75,0xd6 -k "0x4,0x18,0x4d,0xc2,0x5c,0xb,0x32,0x2f,0xfb,0xff,0xd,0xdf,0x9b,0x55,0x87,0x32,0xf3,0x53,0xf8,0x9a,0xf1,0x1b,0x1c,0x89,0x3a,0x8f,0xd5,0xb1,0x4d,0x9d,0x5a,0xed,0x8e,0x92,0xea,0xda,0x95,0x24,0xdf,0xd4,0xcc,0xcc,0x4b,0xe3,0x3c,0x1,0xc8,0x2c,0xb3,0xbf,0xb9,0x21,0x68,0x71,0x5a,0x5b,0xbc,0xc4,0xa,0x24,0x9d,0x74,0xad,0xc,0x68" -a COSE_SIGN1_VERIFY -t INFERENCE

Sample Output
=============

   .. code-block:: console

      Successfully verified the signature
      Payload:: a13a0001387f441f85ab3f
      Inference value from the payload:: (1.340000033378601,)

Example to decode Application Attestation Token(AAT)
====================================================
   .. code-block:: console

      ./cose_verify.py -p 0xd2,0x84,0x43,0xa1,0x1,0x26,0xa0,0x58,0x8c,0xa4,0x3a,0x0,0x1,0x38,0x80,0x58,0x28,0x63,0x32,0x30,0x31,0x38,0x61,0x37,0x62,0x66,0x38,0x34,0x33,0x36,0x34,0x63,0x63,0x37,0x34,0x33,0x34,0x39,0x31,0x61,0x35,0x32,0x62,0x34,0x31,0x32,0x34,0x38,0x34,0x39,0x37,0x35,0x36,0x39,0x65,0x30,0x33,0x3a,0x0,0x1,0x38,0x81,0x58,0x20,0x32,0x37,0x30,0x33,0x36,0x64,0x64,0x31,0x32,0x32,0x62,0x63,0x38,0x32,0x64,0x61,0x35,0x34,0x66,0x63,0x30,0x66,0x32,0x64,0x37,0x64,0x39,0x39,0x34,0x39,0x37,0x62,0x3a,0x0,0x1,0x38,0x82,0x48,0x30,0x2e,0x39,0x2e,0x64,0x65,0x76,0x30,0x3a,0x0,0x1,0x38,0x83,0x58,0x20,0x62,0x38,0x30,0x38,0x35,0x32,0x33,0x38,0x66,0x36,0x65,0x37,0x39,0x30,0x66,0x32,0x35,0x64,0x65,0x33,0x39,0x33,0x65,0x32,0x30,0x33,0x31,0x33,0x36,0x37,0x37,0x36,0x58,0x40,0x36,0xfb,0xfb,0xd9,0xf5,0x8e,0xce,0xf9,0xd0,0x3e,0xdc,0x2c,0x3f,0x40,0x52,0x4e,0x91,0x51,0xcd,0x86,0x4b,0x84,0xf0,0x90,0x7d,0xd1,0xee,0x3c,0x20,0x6,0x1b,0x5a,0xc3,0xe5,0x20,0x64,0xc7,0xef,0x1b,0xa,0xb2,0x83,0x84,0xb5,0xfc,0x85,0xea,0x3c,0x98,0xbd,0xc4,0xfa,0x33,0xa8,0xca,0x2e,0x1c,0xc5,0x67,0xa8,0xb2,0xcb,0xff,0xac -k "0x4,0x4e,0xe2,0x5a,0x92,0x9f,0x62,0xdf,0xe7,0x9b,0x19,0x46,0xda,0x33,0x89,0xe4,0x18,0x11,0x77,0xd1,0xaf,0x28,0x8a,0x1f,0x48,0x40,0x61,0xbe,0x31,0x52,0x43,0x93,0xb4,0x26,0x72,0xba,0xf5,0x2c,0xfd,0x88,0x37,0xae,0x49,0xf1,0xba,0xa1,0x94,0xbe,0x19,0x48,0x1e,0xf8,0xcf,0x9d,0x91,0xb5,0x56,0x5d,0x4,0x79,0xf4,0x50,0x73,0x26,0x10" -a COSE_SIGN1_VERIFY -t AAT

Sample Output
=============

   .. code-block:: console

      Successfully verified the signature
      Payload:: a43a000138805828633230313861376266383433363463633734333439316135326234313234383439373536396530333a00013881582032373033366464313232626338326461353466633066326437643939343937623a0001388248302e392e646576303a0001388358206238303835323338663665373930663235646533393365323033313336373736
      Expected no of claim  4
      [-80001] claim TFLM_VERSION             c2018a7bf84364cc743491a52b41248497569e03
      [-80002] claim TFLM_SINE_MODEL_VERSION  27036dd122bc82da54fc0f2d7d99497b
      [-80003] claim MTVM_VERSION             0.9.dev0
      [-80004] claim MTVM_SINE_MODEL_VERSION  b8085238f6e790f25de393e203136776
